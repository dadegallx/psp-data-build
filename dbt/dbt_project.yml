# =============================================================================
# dbt Project Configuration for Poverty Stoplight Star Schema
# =============================================================================
#
# ARCHITECTURE:
#   Source Schemas: ps_network, ps_families, data_collect (read replica)
#   Target Schemas: staging (views), marts (tables)
#
# MATERIALIZATION STRATEGY:
#   - Staging: views (lightweight, always fresh from source)
#     - Exception: Large join models materialized as tables for performance
#   - Marts: tables (optimized for query performance)
#
# =============================================================================

name: 'psp_data_build'
version: '1.0.0'
config-version: 2

profile: 'psp_data_build'

# Directory paths
model-paths: ["models"]
analysis-paths: ["analyses"]
test-paths: ["tests"]
seed-paths: ["data"]
macro-paths: ["macros"]
snapshot-paths: ["snapshots"]

# Clean targets
clean-targets:
  - "target"
  - "dbt_packages"
  - "logs"

# =============================================================================
# MODEL CONFIGURATIONS
# =============================================================================
# Centralized configuration for all models. Model-specific overrides (like
# indexes) should remain in individual model files using {{ config() }}.
# =============================================================================

models:
  psp_data_build:
    # -------------------------------------------------------------------------
    # STAGING LAYER (Silver)
    # -------------------------------------------------------------------------
    # Default: views for lightweight data cleaning
    # Override in model file for tables requiring indexes
    staging:
      +materialized: view
      +tags: ['staging', 'silver']
      +schema: staging

    # -------------------------------------------------------------------------
    # INTERMEDIATE LAYER (Silver)
    # -------------------------------------------------------------------------
    # Complex business logic transformations
    intermediate:
      +materialized: view
      +tags: ['intermediate', 'silver']
      +schema: intermediate

    # -------------------------------------------------------------------------
    # MARTS LAYER (Gold)
    # -------------------------------------------------------------------------
    # Final semantic layer - all materialized as tables
    marts:
      +materialized: table
      +tags: ['mart', 'gold']
      +schema: marts

      # Dashboard aggregations
      dashboards:
        +materialized: table
        +tags: ['mart', 'dashboard', 'gold']
        +schema: marts

# =============================================================================
# SEEDS & SNAPSHOTS
# =============================================================================

seeds:
  psp_data_build:
    +schema: seeds

snapshots:
  psp_data_build:
    +target_schema: snapshots
